import{b as ae,f as ne,c as le,g as ie,h as G,e as re,i as oe,d as ue}from"./use-key-composition-B9PTisSG.js";import{r as X,l as I,B as L,U as se,k as T,g as fe,j as de,X as J,h as ce,D as ge,i as U,a9 as me}from"./main-CfcVBvI2.js";import{a as he}from"./focus-manager-zjdVGI5d.js";const p={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},H={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleLowerCase()}},te=Object.keys(H);te.forEach((e=>{H[e].regex=new RegExp(H[e].pattern)}));const ve=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+te.join("")+"])|(.)","g"),ee=/[.*+?^${}()|[\]\\]/g,v="",ke={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function Me(e,t,a,n){let l,o,r,i,s,u;const c=X(null),d=X(function(){if(g(),!0===c.value){const t=w(k(e.modelValue));return!1!==e.fillMask?y(t):t}return e.modelValue}());function f(e){if(e<l.length)return l.slice(-e);let t="",a=l;const n=a.indexOf(v);if(-1!==n){for(let n=e-a.length;n>0;n--)t+=v;a=a.slice(0,n)+t+a.slice(n)}return a}function g(){if(c.value=void 0!==e.mask&&0!==e.mask.length&&(!0===e.autogrow||["textarea","text","search","url","tel","password"].includes(e.type)),!1===c.value)return i=void 0,l="",void(o="");const t=void 0===p[e.mask]?e.mask:p[e.mask],a="string"==typeof e.fillMask&&0!==e.fillMask.length?e.fillMask.slice(0,1):"_",n=a.replace(ee,"\\$&"),s=[],u=[],d=[];let f=!0===e.reverseFillMask,g="",h="";t.replace(ve,((e,t,a,n,l)=>{if(void 0!==n){const e=H[n];d.push(e),h=e.negate,!0===f&&(u.push("(?:"+h+"+)?("+e.pattern+"+)?(?:"+h+"+)?("+e.pattern+"+)?"),f=!1),u.push("(?:"+h+"+)?("+e.pattern+")?")}else if(void 0!==a)g="\\"+("\\"===a?"":a),d.push(a),s.push("([^"+g+"]+)?"+g+"?");else{const e=void 0!==t?t:l;g="\\"===e?"\\\\\\\\":e.replace(ee,"\\\\$&"),d.push(e),s.push("([^"+g+"]+)?"+g+"?")}}));const m=new RegExp("^"+s.join("")+"("+(""===g?".":"[^"+g+"]")+"+)?"+(""===g?"":"["+g+"]*")+"$"),w=u.length-1,k=u.map(((t,a)=>0===a&&!0===e.reverseFillMask?new RegExp("^"+n+"*"+t):a===w?new RegExp("^"+t+"("+(""===h?".":h)+"+)?"+(!0===e.reverseFillMask?"$":n+"*")):new RegExp("^"+t)));r=d,i=t=>{const a=m.exec(!0===e.reverseFillMask?t:t.slice(0,d.length+1));null!==a&&(t=a.slice(1).join(""));const n=[],l=k.length;for(let e=0,a=t;e<l;e++){const t=k[e].exec(a);if(null===t)break;a=a.slice(t.shift().length),n.push(...t)}return 0!==n.length?n.join(""):t},l=d.map((e=>"string"==typeof e?e:v)).join(""),o=l.split(v).join(a)}function h(t,r,i){const u=n.value,c=u.selectionEnd,f=u.value.length-c,p=k(t);!0===r&&g();const h=w(p),x=!1!==e.fillMask?y(h):h,M=d.value!==x;u.value!==x&&(u.value=x),!0===M&&(d.value=x),document.activeElement===u&&L((()=>{if(x!==o)if("insertFromPaste"!==i||!0===e.reverseFillMask)if(-1===["deleteContentBackward","deleteContentForward"].indexOf(i))if(!0===e.reverseFillMask)if(!0===M){const e=Math.max(0,x.length-(x===o?0:Math.min(h.length,f+1)));1===e&&1===c?u.setSelectionRange(e,e,"forward"):m.rightReverse(u,e)}else{const e=x.length-f;u.setSelectionRange(e,e,"backward")}else if(!0===M){const e=Math.max(0,l.indexOf(v),Math.min(h.length,c)-1);m.right(u,e)}else{const e=c-1;m.right(u,e)}else{const t=!0===e.reverseFillMask?0===c?x.length>h.length?1:0:Math.max(0,x.length-(x===o?0:Math.min(h.length,f)+1))+1:c;u.setSelectionRange(t,t,"forward")}else{const e=u.selectionEnd;let t=c-1;for(let a=s;a<=t&&a<e;a++)l[a]!==v&&t++;m.right(u,t)}else{const t=!0===e.reverseFillMask?o.length:0;u.setSelectionRange(t,t,"forward")}}));const b=!0===e.unmaskedValue?k(x):x;String(e.modelValue)!==b&&(null!==e.modelValue||""!==b)&&a(b,!0)}I((()=>e.type+e.autogrow),g),I((()=>e.mask),(a=>{if(void 0!==a)h(d.value,!0);else{const a=k(d.value);g(),e.modelValue!==a&&t("update:modelValue",a)}})),I((()=>e.fillMask+e.reverseFillMask),(()=>{!0===c.value&&h(d.value,!0)})),I((()=>e.unmaskedValue),(()=>{!0===c.value&&h(d.value)}));const m={left(e,t){const a=-1===l.slice(t-1).indexOf(v);let n=Math.max(0,t-1);for(;n>=0;n--)if(l[n]===v){t=n,!0===a&&t++;break}if(n<0&&void 0!==l[t]&&l[t]!==v)return m.right(e,0);t>=0&&e.setSelectionRange(t,t,"backward")},right(e,t){const a=e.value.length;let n=Math.min(a,t+1);for(;n<=a;n++){if(l[n]===v){t=n;break}l[n-1]===v&&(t=n)}if(n>a&&void 0!==l[t-1]&&l[t-1]!==v)return m.left(e,a);e.setSelectionRange(t,t,"forward")},leftReverse(e,t){const a=f(e.value.length);let n=Math.max(0,t-1);for(;n>=0;n--){if(a[n-1]===v){t=n;break}if(a[n]===v&&(t=n,0===n))break}if(n<0&&void 0!==a[t]&&a[t]!==v)return m.rightReverse(e,0);t>=0&&e.setSelectionRange(t,t,"backward")},rightReverse(e,t){const a=e.value.length,n=f(a),l=-1===n.slice(0,t+1).indexOf(v);let o=Math.min(a,t+1);for(;o<=a;o++)if(n[o-1]===v){(t=o)>0&&!0===l&&t--;break}if(o>a&&void 0!==n[t-1]&&n[t-1]!==v)return m.leftReverse(e,a);e.setSelectionRange(t,t,"forward")}};function w(t){if(null==t||""===t)return"";if(!0===e.reverseFillMask)return function(e){const t=r,a=l.indexOf(v);let n=e.length-1,o="";for(let l=t.length-1;l>=0&&-1!==n;l--){const r=t[l];let i=e[n];if("string"==typeof r)o=r+o,i===r&&n--;else{if(void 0===i||!r.regex.test(i))return o;do{o=(void 0!==r.transform?r.transform(i):i)+o,n--,i=e[n]}while(a===l&&void 0!==i&&r.regex.test(i))}}return o}(t);const a=r;let n=0,o="";for(let e=0;e<a.length;e++){const l=t[n],r=a[e];if("string"==typeof r)o+=r,l===r&&n++;else{if(void 0===l||!r.regex.test(l))return o;o+=void 0!==r.transform?r.transform(l):l,n++}}return o}function k(e){return"string"!=typeof e||void 0===i?"number"==typeof e?i(""+e):e:i(e)}function y(t){return o.length-t.length<=0?t:!0===e.reverseFillMask&&0!==t.length?o.slice(0,-t.length)+t:t+o.slice(t.length)}return{innerValue:d,hasMask:c,moveCursorForPaste:function(e,t,a){const n=w(k(e.value));t=Math.max(0,l.indexOf(v),Math.min(n.length,t)),s=t,e.setSelectionRange(t,a,"forward")},updateMaskValue:h,onMaskedKeydown:function(a){if(t("keydown",a),!0===se(a)||!0===a.altKey)return;const l=n.value,o=l.selectionStart,r=l.selectionEnd;if(a.shiftKey||(u=void 0),37===a.keyCode||39===a.keyCode){a.shiftKey&&void 0===u&&(u="forward"===l.selectionDirection?o:r);const t=m[(39===a.keyCode?"right":"left")+(!0===e.reverseFillMask?"Reverse":"")];if(a.preventDefault(),t(l,u===o?r:o),a.shiftKey){const e=l.selectionStart;l.setSelectionRange(Math.min(u,e),Math.max(u,e),"forward")}}else 8===a.keyCode&&!0!==e.reverseFillMask&&o===r?(m.left(l,o),l.setSelectionRange(l.selectionStart,r,"backward")):46===a.keyCode&&!0===e.reverseFillMask&&o===r&&(m.rightReverse(l,r),l.setSelectionRange(o,l.selectionEnd,"forward"))},onMaskedClick:function(e){t("click",e),u=void 0}}}function we(e,t){return T((()=>{if("file"===e.type)return function(){const t=e.modelValue;try{const e="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(t)===t&&("length"in t?Array.from(t):[t]).forEach((t=>{e.items.add(t)})),{files:e.files}}catch{return{files:void 0}}}()}))}const Se=fe({name:"QInput",inheritAttrs:!1,props:{...le,...ke,...ne,modelValue:[String,Number,FileList],shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...ae,"paste","change","keydown","click","animationend"],setup(e,{emit:t,attrs:a}){const{proxy:n}=de(),{$q:l}=n,o={};let r,i,s,u=NaN,c=null;const v=X(null),d=ie(e),{innerValue:f,hasMask:g,moveCursorForPaste:p,updateMaskValue:h,onMaskedKeydown:m,onMaskedClick:w}=Me(e,t,A,v),k=we(e),y=T((()=>G(f.value))),x=oe(E),M=re({changeEvent:!0}),b=T((()=>"textarea"===e.type||!0===e.autogrow)),S=T((()=>!0===b.value||["text","search","url","tel","password"].includes(e.type))),C=T((()=>{const t={...M.splitAttrs.listeners.value,onInput:E,onPaste:V,onChange:O,onBlur:z,onFocus:J};return t.onCompositionstart=t.onCompositionupdate=t.onCompositionend=x,!0===g.value&&(t.onKeydown=m,t.onClick=w),!0===e.autogrow&&(t.onAnimationend=F),t})),R=T((()=>{const t={tabindex:0,"data-autofocus":!0===e.autofocus||void 0,rows:"textarea"===e.type?6:void 0,"aria-label":e.label,name:d.value,...M.splitAttrs.attributes.value,id:M.targetUid.value,maxlength:e.maxlength,disabled:!0===e.disable,readonly:!0===e.readonly};return!1===b.value&&(t.type=e.type),!0===e.autogrow&&(t.rows=1),t}));function V(a){if(!0===g.value&&!0!==e.reverseFillMask){const e=a.target;p(e,e.selectionStart,e.selectionEnd)}t("paste",a)}function E(a){if(!a||!a.target)return;if("file"===e.type)return void t("update:modelValue",a.target.files);const n=a.target.value;if(!0!==a.target.qComposing){if(!0===g.value)h(n,!1,a.inputType);else if(A(n),!0===S.value&&a.target===document.activeElement){const{selectionStart:e,selectionEnd:t}=a.target;void 0!==e&&void 0!==t&&L((()=>{a.target===document.activeElement&&0===n.indexOf(a.target.value)&&a.target.setSelectionRange(e,t)}))}!0===e.autogrow&&j()}else o.value=n}function F(e){t("animationend",e),j()}function A(a,n){s=()=>{c=null,"number"!==e.type&&!0===o.hasOwnProperty("value")&&delete o.value,e.modelValue!==a&&u!==a&&(u=a,!0===n&&(i=!0),t("update:modelValue",a),L((()=>{u===a&&(u=NaN)}))),s=void 0},"number"===e.type&&(r=!0,o.value=a),void 0!==e.debounce?(null!==c&&clearTimeout(c),o.value=a,c=setTimeout(s,e.debounce)):s()}function j(){requestAnimationFrame((()=>{const e=v.value;if(null!==e){const t=e.parentNode.style,{scrollTop:a}=e,{overflowY:n,maxHeight:o}=!0===l.platform.is.firefox?{}:window.getComputedStyle(e),r=void 0!==n&&"scroll"!==n;!0===r&&(e.style.overflowY="hidden"),t.marginBottom=e.scrollHeight-1+"px",e.style.height="1px",e.style.height=e.scrollHeight+"px",!0===r&&(e.style.overflowY=parseInt(o,10)<e.scrollHeight?"auto":"hidden"),t.marginBottom="",e.scrollTop=a}}))}function O(e){x(e),null!==c&&(clearTimeout(c),c=null),null==s||s(),t("change",e.target.value)}function z(t){void 0!==t&&J(t),null!==c&&(clearTimeout(c),c=null),null==s||s(),r=!1,i=!1,delete o.value,"file"!==e.type&&setTimeout((()=>{null!==v.value&&(v.value.value=void 0!==f.value?f.value:"")}))}function Z(){return!0===o.hasOwnProperty("value")?o.value:void 0!==f.value?f.value:""}I((()=>e.type),(()=>{v.value&&(v.value.value=e.modelValue)})),I((()=>e.modelValue),(t=>{if(!0===g.value){if(!0===i&&(i=!1,String(t)===u))return;h(t)}else f.value!==t&&(f.value=t,"number"===e.type&&!0===o.hasOwnProperty("value")&&(!0===r?r=!1:delete o.value));!0===e.autogrow&&L(j)})),I((()=>e.autogrow),(e=>{!0===e?L(j):null!==v.value&&a.rows>0&&(v.value.style.height="auto")})),I((()=>e.dense),(()=>{!0===e.autogrow&&L(j)})),ce((()=>{z()})),ge((()=>{!0===e.autogrow&&j()})),Object.assign(M,{innerValue:f,fieldClass:T((()=>"q-"+(!0===b.value?"textarea":"input")+(!0===e.autogrow?" q-textarea--autogrow":""))),hasShadow:T((()=>"file"!==e.type&&"string"==typeof e.shadowText&&0!==e.shadowText.length)),inputRef:v,emitValue:A,hasValue:y,floatingLabel:T((()=>!0===y.value&&("number"!==e.type||!1===isNaN(f.value))||G(e.displayValue))),getControl:()=>U(!0===b.value?"textarea":"input",{ref:v,class:["q-field__native q-placeholder",e.inputClass],style:e.inputStyle,...R.value,...C.value,..."file"!==e.type?{value:Z()}:k.value}),getShadowControl:()=>U("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(!0===b.value?"":" text-no-wrap")},[U("span",{class:"invisible"},Z()),U("span",e.shadowText)])});const B=ue(M);return Object.assign(n,{focus:function(){he((()=>{const e=document.activeElement;null!==v.value&&v.value!==e&&(null===e||e.id!==M.targetUid.value)&&v.value.focus({preventScroll:!0})}))},select:function(){var e;null==(e=v.value)||e.select()},getNativeElement:()=>v.value}),me(n,"nativeEl",(()=>v.value)),B}});export{Se as Q};
